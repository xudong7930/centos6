# redis的缓存穿透和雪崩


## 缓存穿透
用户想要查询一个数据，发现redis内存数据库没有，也就是缓存没有命中，于是向持久层数据库查询，发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀），于是
都去请求持久层数据库，这会带来很大的压力。


解决办法：
1.布隆过滤器,是一种数据结构，对所有可能查询的参数以hash存储，在controller处校验，不符合规则就丢弃。
2.缓存控对象，当数据库没命中后，就将返回的空对象缓存起来，同时设置一个过期时间，之后在访问这个数据就从缓存中获取，保护了后段数据库
缺点：1.缓存空对象要耗费更多的空间去存储 2.即使设置了过期时间，也会导致缓存层和数据层有一段时间窗口不一致，这对数据一致性要求较高的业务会有影响

## 缓存击穿
指一个key非常热点，不停的扛着大并发，大并发集中对这一个点进行访问，当key失效瞬间，持续的大并发就穿破缓存，直接请求数据库！

解决办法：
1.设置热点数据永不过期
2.加互斥锁：使用分布式锁，保证对每个key同时只有一个线程去查询后端服务，其它线程没有获得分布式锁的权限等待即可。

## 雪崩

指在某一个时间段，缓存集中过期失效！（热门商品放到缓存中，缓存1小时，1小时后大流量并发访问数据库的情况）

解决办法：
1.让redis高可用，多几台机器，搭建集群
2.限流降级，缓存失效后，通过加锁或者队列来控制数据库读写数量
3.数据预热，正式部署前，对可能的数据先访问一下，这样大部分数据就预先加载到缓存中来。手动触发加载缓存不同的key，设置不同的过期时间。





